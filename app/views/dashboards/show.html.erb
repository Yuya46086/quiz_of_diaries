<h1><%= current_user.email %>さんようこそ!</h1>

<div class="dashboard-content">
  <div class="diary-section">
    <h2>日記の操作</h2>
    <div class="diary-actions">
      <%= link_to "日記を書く", new_post_path, class: "action-button" %>
      <%= link_to "日記一覧を見る", posts_path, class: "action-button" %>
    </div>

    <div class="latest-post-preview">
      <h3>最新の日記</h3>
      <% latest_post = current_user.posts.order(post_date: :desc).first %>
      <% if latest_post.present? %>
        <p>
          <strong>日付:</strong> <%= latest_post.post_date.strftime("%Y/%m/%d") %>
        </p>
        <p class="content-preview">
          <%= latest_post.content.truncate(50) %>
        </p>
        <%= link_to "続きを読む", post_path(latest_post) %>
      <% else %>
        <p>まだ日記はありません。新しい日記を投稿しましょう！</p>
      <% end %>
    </div>
  </div>

  <hr>

  <div class="quiz-section">
    <h2>クイズに挑戦</h2>

    <div class="quiz-challenge">
      <%# @remaining_quiz_count はコントローラーで計算済み %>
      <% if @remaining_quiz_count > 0 %>
        <p class="challenge-status">まだ挑戦できるクイズが **<%= @remaining_quiz_count %>** 個あります！</p>
        <%# new_quiz_attempt_path はクイズ挑戦画面へのルーティング %>
        <%= link_to "新しいクイズに挑戦！", new_quiz_attempt_path, class: "big-button primary-color" %>
      <% else %>
        <p class="challenge-status">挑戦できるクイズは全て解き終わりました！</p>
        <%= link_to '新しい日記を投稿する', new_post_path, class: "action-button secondary-color" %>
      <% end %>
      <p>（挑戦したクイズは、しばらく出題されません）</p>
    </div>

    <div class="score-actions">
      <h3>最新のクイズ結果</h3>
      <%# @latest_attempt はコントローラーで取得済み %>
      <% if @latest_attempt.present? %>
        <% if @latest_attempt.is_correct %>
          <p class="result-message correct">🎉 **正解です！** <%= @latest_attempt.score_awarded %>点を獲得しました！</p>
        <% else %>
          <p class="result-message incorrect">😥 **不正解です。** 0点でした。</p>
        <% end %>
        
        <p><strong>出題:</strong> <%= @latest_attempt.daily_quiz.question_text.truncate(30) %></p>
        <p><strong>あなたの解答:</strong> <%= @latest_attempt.user_answer %></p>
      <% else %>
        <p>まだクイズに挑戦していません。</p>
      <% end %>
    </div>
  </div>

</div>